(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{369:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"aws服务器训练深度学习模型-以yolov5为例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aws服务器训练深度学习模型-以yolov5为例"}},[s._v("#")]),s._v(" AWS服务器训练深度学习模型(以Yolov5为例)")]),s._v(" "),a("p",[s._v("大二时候学习了深度学习后，开始上手自己训练模型。在训练过几个模型后，觉得使用自己的笔记本训练模型算力实在是吃紧(后来还导致笔记本烧主板)，于是租用了AWS服务器进行模型训练。\n参考了李沐老师的"),a("a",{attrs:{href:"https://www.bilibili.com/video/BV1MA411L78X?spm_id_from=333.999.0.0&vd_source=40f1ef60578ccbbc14f177e18d61fda6",target:"_blank",rel:"noopener noreferrer"}},[s._v("视频"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("现在回过头来看，还是用Google的Colab会员训练似乎更划算一些，能租到A100和T4，费用也不算太离谱")])]),s._v(" "),a("aside",[s._v("\n💡 出于经费限制，我当时选择了最低配置的服务器，不过对于训练数据集较大的情况下, 服务器的内存或显存大小可能会影响模型的训练速度, 当然选择更好的配置也会增加费用\n")]),s._v(" "),a("h2",{attrs:{id:"购买aws服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#购买aws服务器"}},[s._v("#")]),s._v(" 购买AWS服务器")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("注册AWS账号")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://aws.amazon.com/cn/console/",target:"_blank",rel:"noopener noreferrer"}},[s._v("AWS Console控制台_亚马逊云管理控制台-AWS云服务"),a("OutboundLink")],1)]),s._v(" "),a("aside",[s._v("\n 💡 申请实例数量需要经过亚马逊人工审核 较耗时\n ")])]),s._v(" "),a("li",[a("p",[s._v("配置服务器类型")]),s._v(" "),a("p",[s._v("系统Ubuntu")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/yolov5_0.png",alt:"选择系统类型"}})]),s._v(" "),a("p",[s._v("较便宜GPU类型：g4dn")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/yolov5_1.png",alt:"选择实例类型"}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查看配置和价格网站")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://instances.vantage.sh",target:"_blank",rel:"noopener noreferrer"}},[s._v("Amazon EC2 Instance Comparison"),a("OutboundLink")],1)])])]),s._v(" "),a("p",[s._v("存储从8GB改为20GB或者更大")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/yolov5_2.png",alt:"选择存储"}})]),s._v(" "),a("p",[s._v("选择密钥(没有密匙的话可以新建一个)")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/yolov5_3.png",alt:"选择密匙"}})])])]),s._v(" "),a("p",[s._v("复制ip地址")]),s._v(" "),a("h2",{attrs:{id:"登陆服务器并配置环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登陆服务器并配置环境"}},[s._v("#")]),s._v(" 登陆服务器并配置环境")]),s._v(" "),a("h3",{attrs:{id:"登陆服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登陆服务器"}},[s._v("#")]),s._v(" 登陆服务器")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("SSH连接到服务器")]),s._v(" "),a("p",[s._v("先修改权限 连接服务器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更改密钥权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(" Downloads/key.pem\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#连接服务器")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" Downloads/key.pem ubuntu@***.***.***\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#更新软件源")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装必要依赖包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" build-essential\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])]),s._v(" "),a("h3",{attrs:{id:"安装cuda环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装cuda环境"}},[s._v("#")]),s._v(" 安装CUDA环境")]),s._v(" "),a("p",[s._v("去英伟达官网下载cuda")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://developer.nvidia.com/cuda-downloads",target:"_blank",rel:"noopener noreferrer"}},[s._v("CUDA Toolkit 11.7 Downloads"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装cuda")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" cuda.***.run\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#选择accept然后install")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" .bashrc "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#我倾向于使用vim来编辑，选择一个自己熟悉的文本编辑器即可")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#shift+g “G”跳到最后一行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LD_library_PATH")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/cuda-11.2/lib64\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"安装miniconda"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装miniconda"}},[s._v("#")]),s._v(" 安装miniconda")]),s._v(" "),a("p",[s._v("去miniconda官网获取安装链接(根据服务器的架构选择对应的安装包，一般x86的linux机器选择linux64bit即可，arm则对应aarch64)")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.conda.io/en/latest/miniconda.html#linux-installers",target:"_blank",rel:"noopener noreferrer"}},[s._v("Miniconda - Conda documentation"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行sh文件 安装")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" Miniconda3 Linux py39_4.9.2-linu-x86_64.sh\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#按q跳过阅读 全程输入yes同意协议")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#激活环境")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#新建环境")]),s._v("\nconda create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" yolo "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("python")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.8")]),s._v(" pip\nconda activate yolo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"安装pytorch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装pytorch"}},[s._v("#")]),s._v(" 安装pytorch")]),s._v(" "),a("p",[s._v("去官网获取pytorch下载链接（Stable -Linux-Pip-python-CUDA11.*）")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://pytorch.org/get-started/locally/",target:"_blank",rel:"noopener noreferrer"}},[s._v("PyTorch"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("pip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu116\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-U")]),s._v(" jupyter\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"上传代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传代码"}},[s._v("#")]),s._v(" 上传代码")]),s._v(" "),a("p",[s._v("git下载Yolov5代码 上传jupyter notebook代码")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/ultralytics/yolov5",target:"_blank",rel:"noopener noreferrer"}},[s._v("GitHub - ultralytics/yolov5: YOLOv5 🚀 in PyTorch > ONNX > CoreML > TFLite"),a("OutboundLink")],1)]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" https://github.com/ultralytics/yolov5.git\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" requirements.txt\njupyter notebook\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ssh")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" Downloads/key.pem -L888:locahost:8888 ubuntu@****.****.***\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上传代码即可开始训练")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("aside",[s._v("\n💡 注意密钥的权限限制 此外Yolov5的代码仍需要进行一定的修改才能进行训练\n")]),s._v(" "),a("h3",{attrs:{id:"开始训练"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始训练"}},[s._v("#")]),s._v(" 开始训练")]),s._v(" "),a("p",[s._v("接下来就是开始训练模型了，第一次训练模型的时候完全不懂怎么训练，使用了质量不高的Dataset，导致模型在测试集上的表现一直提不上去，就算使用了Data Augment和Dropout这些方法也无济于事,此外也尝试过使用迁移学习的一些方法，冻结部分网络结构的权重再进行针对性的训练，但是最终结果都还是不够理想。")]),s._v(" "),a("p",[s._v("后来发现了"),a("a",{attrs:{href:"https://universe.roboflow.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Roboflow"),a("OutboundLink")],1),s._v("这个网站上有大量的图像数据集，而且有Health Check功能，可以提前判断数据集的质量。最终找到一个质量还算比较好的数据集，最后还是训练出了比较满意的结果(不过和那些SOTA模型还是没法比的hhhh)")])])}),[],!1,null,null,null);a.default=e.exports}}]);