<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chisel 环境搭建 | Emin&#39;s Blog</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/img/logo.ico">
    <meta name="description" content="Welcome to Emin&#39;s Blog">
    
    <link rel="preload" href="/assets/css/0.styles.121f282a.css" as="style"><link rel="preload" href="/assets/js/app.1873182b.js" as="script"><link rel="preload" href="/assets/js/3.be01622c.js" as="script"><link rel="preload" href="/assets/js/2.4fd48b6f.js" as="script"><link rel="preload" href="/assets/js/43.557d8f87.js" as="script"><link rel="prefetch" href="/assets/js/1.20dc3f49.js"><link rel="prefetch" href="/assets/js/10.bdc2b503.js"><link rel="prefetch" href="/assets/js/11.c0f61c9e.js"><link rel="prefetch" href="/assets/js/12.68716719.js"><link rel="prefetch" href="/assets/js/13.95d73489.js"><link rel="prefetch" href="/assets/js/14.00647e98.js"><link rel="prefetch" href="/assets/js/15.dbf980b1.js"><link rel="prefetch" href="/assets/js/16.241cc666.js"><link rel="prefetch" href="/assets/js/17.59a7545e.js"><link rel="prefetch" href="/assets/js/18.0aa1f41a.js"><link rel="prefetch" href="/assets/js/19.e5af0120.js"><link rel="prefetch" href="/assets/js/20.fca9ca50.js"><link rel="prefetch" href="/assets/js/21.0dac1494.js"><link rel="prefetch" href="/assets/js/22.24af22d0.js"><link rel="prefetch" href="/assets/js/23.728ad196.js"><link rel="prefetch" href="/assets/js/24.e878f33c.js"><link rel="prefetch" href="/assets/js/25.89db4503.js"><link rel="prefetch" href="/assets/js/26.96b4eba4.js"><link rel="prefetch" href="/assets/js/27.74758f4d.js"><link rel="prefetch" href="/assets/js/28.989860d8.js"><link rel="prefetch" href="/assets/js/29.289b0936.js"><link rel="prefetch" href="/assets/js/30.b3a382df.js"><link rel="prefetch" href="/assets/js/31.1a331b41.js"><link rel="prefetch" href="/assets/js/32.5b3890d5.js"><link rel="prefetch" href="/assets/js/33.a76cef1f.js"><link rel="prefetch" href="/assets/js/34.8e53ee7c.js"><link rel="prefetch" href="/assets/js/35.d72443eb.js"><link rel="prefetch" href="/assets/js/36.4db7bfb8.js"><link rel="prefetch" href="/assets/js/37.6259ad8f.js"><link rel="prefetch" href="/assets/js/38.ffac5466.js"><link rel="prefetch" href="/assets/js/39.0f53bf30.js"><link rel="prefetch" href="/assets/js/4.a57f9af6.js"><link rel="prefetch" href="/assets/js/40.4689cd91.js"><link rel="prefetch" href="/assets/js/41.935ef6d1.js"><link rel="prefetch" href="/assets/js/42.ee865771.js"><link rel="prefetch" href="/assets/js/44.711d4403.js"><link rel="prefetch" href="/assets/js/45.3b82f05c.js"><link rel="prefetch" href="/assets/js/46.94a57260.js"><link rel="prefetch" href="/assets/js/47.a162bf59.js"><link rel="prefetch" href="/assets/js/48.1f7190b6.js"><link rel="prefetch" href="/assets/js/49.3f7de9ec.js"><link rel="prefetch" href="/assets/js/5.1d48745d.js"><link rel="prefetch" href="/assets/js/50.8f784f88.js"><link rel="prefetch" href="/assets/js/51.a3498040.js"><link rel="prefetch" href="/assets/js/52.d50ff522.js"><link rel="prefetch" href="/assets/js/6.237dd15b.js"><link rel="prefetch" href="/assets/js/9.7634c8c8.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.e3b34c5f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.121f282a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Emin's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/intro/intro/" class="nav-link">个人介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/notes/intro/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/IC/intro/" class="nav-link">数字IC</a></li><li class="dropdown-item"><!----> <a href="/notes/AI/intro/" class="nav-link">Deep Learning</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Emin017" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Emin's GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/intro/intro/" class="nav-link">个人介绍</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/notes/intro/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/IC/intro/" class="nav-link">数字IC</a></li><li class="dropdown-item"><!----> <a href="/notes/AI/intro/" class="nav-link">Deep Learning</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><!----> <span class="title" style="display:;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Emin017" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Emin's GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>体系结构&amp;数字IC</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Verilator</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>GEM5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Chisel</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/IC/chisel/start/" aria-current="page" class="active sidebar-link">Chisel 环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#什么是-chisel" class="sidebar-link">什么是 Chisel？</a></li><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#获取-chisel-模板工程-template" class="sidebar-link">获取 Chisel 模板工程 (template)</a></li><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#安装依赖软件包" class="sidebar-link">安装依赖软件包</a></li><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#开始构建" class="sidebar-link">开始构建</a></li><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#使用-mill-生成-ide-support" class="sidebar-link">使用 MILL 生成 IDE Support</a></li><li class="sidebar-sub-header level2"><a href="/notes/IC/chisel/start/#可能会遇到的坑" class="sidebar-link">可能会遇到的坑</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>一生一芯</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>深度学习</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0" title="分类" data-v-06225672>学习笔记</a></li><li data-v-06225672><a href="/categories/?category=%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%26%E6%95%B0%E5%AD%97IC" title="分类" data-v-06225672>体系结构&amp;数字IC</a></li><li data-v-06225672><a href="/categories/?category=Chisel" title="分类" data-v-06225672>Chisel</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-03-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Chisel 环境搭建<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="chisel-环境搭建"><a href="#chisel-环境搭建" class="header-anchor">#</a> Chisel 环境搭建</h1> <blockquote><p>新手在最开始接触 Chisel 时可能会遇到各种各样的问题，例如怎么构建 Chisel、怎么生成 verilog，网上可能会有一些教程介绍了如何上手 Chisel，但是由于这些年 Chisel 的不断升级迭代，这些教程中提到的一些方法可能已经过时（例如 Chisel 更改了生成 Verilog 的 api、编译器从 SFC 换成了 MLIR)，
因此本文会记录一些我在搭建 Chisel 开发环境时遇到的坑和注意点。

但是我也还是无法保证本文提供的方法能和未来的 Chisel 兼容 ( Chisel 更新的越来越快了 qwq )。此外，由于我在 Linux 上进行开发，因此本文只介绍 Linux 上的配置方法（如有在 Windows 上开发的需求，请自行搜索）。</p></blockquote> <h2 id="什么是-chisel"><a href="#什么是-chisel" class="header-anchor">#</a> 什么是 Chisel？</h2> <p><a href="https://www.chisel-lang.org/" target="_blank" rel="noopener noreferrer">Chisel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（Constructing Hardware In a Scala Embedded Language）是 UC Berkeley 开发的一种开源硬件构造语言。它是建构在 Scala 语言之上的领域专用语言（DSL），支持高度参数化的硬件生成器。
Chisel 将硬件构造原语添加到 Scala 编程语言中，为设计人员提供了现代编程语言的强大功能，可以编写复杂的、可参数化的电路生成器，从而生成可综合的 Verilog。 这种生成器方法可以创建可重用的组件和库，例如 Chisel 标准库 中的 FIFO 队列和仲裁器，从而提高了设计的抽象级别，同时保留了细粒度的控制。</p> <h2 id="获取-chisel-模板工程-template"><a href="#获取-chisel-模板工程-template" class="header-anchor">#</a> 获取 Chisel 模板工程 (template)</h2> <p>这里有一份 <a href="https://www.chipsalliance.org/" target="_blank" rel="noopener noreferrer">Chipsalliance<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 提供的 <a href="https://github.com/chipsalliance/chisel-template" target="_blank" rel="noopener noreferrer">模板工程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, 它同时提供了 SBT 和 MILL 的构建配置，我们只需要点击右上角的绿色按钮，选择“Create a new repository”就能开始使用模板了。
<img src="https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/chise-template.png" alt="使用 Chisel 工程模板">
可以自由的选择创建仓库的设置。</p> <p><img src="https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/create-template.png" alt="创建 Chisel 工程模板">
完成创建后将仓库下载到本地就能开始开发了。
<img src="https://emin-blog.oss-cn-shanghai.aliyuncs.com/img/clone-template.png" alt="下载模板工程"></p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>如果你不想在自己的 Github 上创建模板工程，也可以直接下载 chipsalliance 提供的模板（在 shell 中执行如下命令）。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/chipsalliance/chisel-template.git
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></div> <h2 id="安装依赖软件包"><a href="#安装依赖软件包" class="header-anchor">#</a> 安装依赖软件包</h2> <p>Chisel 主要依赖 JDK、SBT/MILL 和 Verilator ( 模板中的测试使用 svsim，需要 Verilator 作为测试后端 )。</p> <h3 id="安装-jdk"><a href="#安装-jdk" class="header-anchor">#</a> 安装 JDK</h3> <p>各种 Linux 发行版的包管理器上一般都会有提供 JDK 的下载
例如在 Ubuntu 上执行：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openjdk-11-jdk
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>在 Arch Linux 上执行：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> pacman <span class="token parameter variable">-S</span> jdk11-openjdk
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要查看安装好的 Java 版本：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">java</span> <span class="token parameter variable">-version</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果有正常输出，则表示安装成功</p> <h3 id="安装-verilator"><a href="#安装-verilator" class="header-anchor">#</a> 安装 Verilator</h3> <p>由于这个 Chisel 模板工程中的测试需要使用 Verilator 作为测试后端，所以我们还需要安装 Verilator，安装教程在 <a href="/notes/IC/verilator/start/">这里</a>。</p> <h3 id="安装-mill"><a href="#安装-mill" class="header-anchor">#</a> 安装 MILL</h3> <p>Scala 构建工具主要有 SBT 和 MILL 两种，我选择的构建工具是 MILL ,<a href="https://www.lihaoyi.com/post/SoWhatsSoSpecialAboutTheMillScalaBuildTool.html" target="_blank" rel="noopener noreferrer">这里<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 介绍了不同构建工具之间的区别，MILL 的构建配置文件 (build.sc) 更为简洁、有更好的可读性，此外还可以在构建配置文件中使用函数式编程。
要获取 MILL 可以在 shell 中执行下面这行命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/com-lihaoyi/mill/releases/download/0.11.5/0.11.5 <span class="token operator">&gt;</span> mill <span class="token operator">&amp;&amp;</span> <span class="token function">chmod</span> +x mill
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这时候你会发现在当前文件夹下面多出了一个 MILL，这时我们可以选择将其移动到系统路径 ( PATH ) 中，也可以选择在当前文件夹下面使用 （执行<code>./mill</code>) 。</p> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>关于 MILL 工具的教程，可以看这个 <a href="https://alvinalexander.com/scala/mill-build-tool/intro/" target="_blank" rel="noopener noreferrer">博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h2 id="开始构建"><a href="#开始构建" class="header-anchor">#</a> 开始构建</h2> <p>接下来我们可以开始测试 Chisel 代码能否正常构建了，我们来到刚刚下载好的模板工程文件夹下面执行：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mill %NAME%.test <span class="token comment"># %NAME%应该被替换为我们工程的名字，build.sc 中的%NAME%也应该做相应的修改</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>会得到如下的输出：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ mill <span class="token parameter variable">-i</span> playground.test <span class="token comment"># 我这将%NAME%替换为了 playground</span>
<span class="token punctuation">[</span>build.sc<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">48</span>/52<span class="token punctuation">]</span> compile
Compiling compiler interface<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> compiling <span class="token number">1</span> Scala <span class="token builtin class-name">source</span> to /home/emin/workbench/test/chisel-template/out/mill-build/compile.dest/classes <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token keyword">done</span> compiling
<span class="token punctuation">[</span><span class="token number">50</span>/83<span class="token punctuation">]</span> playground.compile
Compiling compiler interface<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> compiling <span class="token number">2</span> Scala sources to /home/emin/workbench/test/chisel-template/out/playground/compile.dest/classes <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token keyword">done</span> compiling
<span class="token punctuation">[</span><span class="token number">76</span>/83<span class="token punctuation">]</span> playground.test.compile
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> compiling <span class="token number">1</span> Scala <span class="token builtin class-name">source</span> to /home/emin/workbench/test/chisel-template/out/playground/test/compile.dest/classes <span class="token punctuation">..</span>.
<span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token keyword">done</span> compiling
<span class="token punctuation">[</span><span class="token number">83</span>/83<span class="token punctuation">]</span> playground.test.test
GCDSpec:
- Gcd should calculate proper greatest common denominator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>这说明我们已经成功构建 Chisel 。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果没有修改 %NAME% 直接执行<code>mill %NAME%.test</code>则会得到类似于下面的输出：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span> targets failed
generateScriptSources build.sc:10:9 expected <span class="token punctuation">(</span><span class="token string">&quot;}&quot;</span> <span class="token operator">|</span> end-of-input<span class="token punctuation">)</span>
object %NAME% extends SbtModule <span class="token punctuation">{</span> m <span class="token operator">=</span><span class="token operator">&gt;</span>
        ^
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>这时我们需要到 <code>build.sc</code> 中将<code>%NAME</code>替换为我们工程的名字。我这将<code>%NAME%</code>修改为了<code>playground</code>，所以 <code>build.sc</code> 应该是：</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">object</span> playground <span class="token keyword">extends</span> SbtModule <span class="token punctuation">{</span> m <span class="token keyword">=&gt;</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> millSourcePath <span class="token operator">=</span> os<span class="token punctuation">.</span>pwd
  <span class="token keyword">override</span> <span class="token keyword">def</span> scalaVersion <span class="token operator">=</span> <span class="token string">&quot;2.13.12&quot;</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> scalacOptions <span class="token operator">=</span> Seq<span class="token punctuation">(</span>
    <span class="token string">&quot;-language:reflectiveCalls&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;-deprecation&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;-feature&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;-Xcheckinit&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> ivyDeps <span class="token operator">=</span> Agg<span class="token punctuation">(</span>
    <span class="token string-interpolation"><span class="token id function">ivy</span><span class="token string">&quot;org.chipsalliance::chisel:6.2.0&quot;</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> scalacPluginIvyDeps <span class="token operator">=</span> Agg<span class="token punctuation">(</span>
    <span class="token string-interpolation"><span class="token id function">ivy</span><span class="token string">&quot;org.chipsalliance:::chisel-plugin:6.2.0&quot;</span></span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">object</span> test <span class="token keyword">extends</span> SbtModuleTests <span class="token keyword">with</span> TestModule<span class="token punctuation">.</span>ScalaTest <span class="token punctuation">{</span>
    <span class="token keyword">override</span> <span class="token keyword">def</span> ivyDeps <span class="token operator">=</span> m<span class="token punctuation">.</span>ivyDeps<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">++</span> Agg<span class="token punctuation">(</span>
      <span class="token string-interpolation"><span class="token id function">ivy</span><span class="token string">&quot;org.scalatest::scalatest::3.2.16&quot;</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></details></div> <p>如果需要生成 Verilog 文件，则执行下面这行命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ mill <span class="token parameter variable">-i</span> playground.runMain gcd.GCD
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>这里的<code>playground</code>是我们刚刚修改的<code>%NAME%</code>，<code>gcd</code>是<code>GCD.scala</code>文件所在的软件包（在 src/main/scala/gcd 目录下），在<code>GCD.scala</code>中定义了如下的伴生对象：</p> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">object</span> GCD <span class="token keyword">extends</span> App <span class="token punctuation">{</span>
  ChiselStage<span class="token punctuation">.</span>emitSystemVerilogFile<span class="token punctuation">(</span>
    <span class="token keyword">new</span> GCD<span class="token punctuation">,</span>
    firtoolOpts <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token string">&quot;-disable-all-randomization&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-strip-debug-info&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>其中<code>ChiselStage.emitSystemVerilogFile</code>就是生成 System Verilog 文件的 Api，我们执行这个伴生对象就可以生成 Verilog 了。
模板工程中其实还提供了<code>DecoupledGCD</code>，如果想要生成它的 System Verilog 文件，则只需将<code>new GCD</code>替换为<code>new DecoupledGCD</code>就可以生成对应的文件 (<code>DecoupledGCD</code>需要提供宽度参数，因此需要改成类似于<code>new Decoupled(2)</code>)。
你也可以将生成 Verilog 文件的对象改为其他名称，只需要修改对应的生成命令，保持上文提到的规则就可以了 ( <code>mill -i %NAME%.runMain 软件包。对象名</code> )。</p></div> <h2 id="使用-mill-生成-ide-support"><a href="#使用-mill-生成-ide-support" class="header-anchor">#</a> 使用 MILL 生成 IDE Support</h2> <p>MILL 的 <a href="https://mill-build.com/mill/Installation_IDE_Support.html" target="_blank" rel="noopener noreferrer">文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中有对如何生成 IDE 支持进行说明。
要生成 BSP Support：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mill mill.bsp.BSP/install
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>要生成 IDEA 支持：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mill mill.idea.GenIdea/idea
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">提示</p> <p>JetBrains 公司推出 Java 开发工具 <a href="https://www.jetbrains.com/idea/" target="_blank" rel="noopener noreferrer">IDEA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 有较为智能的补全提示和无缝的开箱即用体验，因此我个人更推荐使用 IDEA 进行 Chisel 开发</p></div> <h2 id="可能会遇到的坑"><a href="#可能会遇到的坑" class="header-anchor">#</a> 可能会遇到的坑</h2> <h3 id="verilator-需要-c-14-特性"><a href="#verilator-需要-c-14-特性" class="header-anchor">#</a> Verilator 需要 C++14 特性</h3> <p>如果你安装的 Verilator 是 <code>5.020</code> 以上的版本，同时使用了 <code>Chisel6.2.0</code> 以下的版本，在运行<code>mill -i __.test</code>时可能会遇到如下报错：</p> <details class="custom-block details"><summary>点击查看</summary> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>info<span class="token punctuation">]</span> <span class="token keyword">done</span> compiling
<span class="token punctuation">[</span><span class="token number">83</span>/83<span class="token punctuation">]</span> playground.test.test
GCDSpec:
- Gcd should calculate proper greatest common denominator *** FAILED ***
  java.lang.Exception: make: Entering directory <span class="token string">'/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default'</span>
<span class="token function">ls</span> <span class="token builtin class-name">.</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> Makefile <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> execution-script.txt <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span>
<span class="token punctuation">\</span>
/usr/local/bin/verilator <span class="token punctuation">\</span>::: details
        <span class="token string">'--cc'</span> <span class="token punctuation">\</span>
        <span class="token string">'--exe'</span> <span class="token punctuation">\</span>
        <span class="token string">'--build'</span> <span class="token punctuation">\</span>
        <span class="token string">'-o'</span> <span class="token punctuation">\</span>
        <span class="token string">'../simulation'</span> <span class="token punctuation">\</span>
        <span class="token string">'--top-module'</span> <span class="token punctuation">\</span>
        <span class="token string">'svsimTestbench'</span> <span class="token punctuation">\</span>
        <span class="token string">'--Mdir'</span> <span class="token punctuation">\</span>
        <span class="token string">'verilated-sources'</span> <span class="token punctuation">\</span>
        <span class="token string">'-CFLAGS'</span> <span class="token punctuation">\</span>
        <span class="token string">'-std=c++11 -I/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default -DSVSIM_ENABLE_VERILATOR_SUPPORT'</span> <span class="token punctuation">\</span>
        <span class="token string">'../primary-sources/DecoupledGcd.sv'</span> <span class="token string">'testbench.sv'</span> <span class="token string">'../generated-sources/c-dpi-bridge.cpp'</span> <span class="token string">'../generated-sources/simulation-driver.cpp'</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Entering directory <span class="token string">'/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default/verilated-sources'</span>
ccache clang++  -I.  <span class="token parameter variable">-MMD</span> -I/usr/local/share/verilator/include -I/usr/local/share/verilator/include/vltstd <span class="token parameter variable">-DVM_COVERAGE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_SC</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE_FST</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE_VCD</span><span class="token operator">=</span><span class="token number">0</span> -faligned-new -fbracket-depth<span class="token operator">=</span><span class="token number">4096</span> -fcf-protection<span class="token operator">=</span>none -Qunused-arguments -Wno-bool-operation -Wno-c++11-narrowing -Wno-constant-logical-operand -Wno-non-pod-varargs -Wno-parentheses-equality -Wno-shadow -Wno-sign-compare -Wno-tautological-bitwise-compare -Wno-tautological-compare -Wno-uninitialized -Wno-unused-but-set-parameter -Wno-unused-but-set-variable -Wno-unused-parameter -Wno-unused-variable    <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11 -I/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default <span class="token parameter variable">-DSVSIM_ENABLE_VERILATOR_SUPPORT</span>   <span class="token parameter variable">-Os</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-o</span> c-dpi-bridge.o c-dpi-bridge.cpp
ccache clang++  -I.  <span class="token parameter variable">-MMD</span> -I/usr/local/share/verilator/include -I/usr/local/share/verilator/include/vltstd <span class="token parameter variable">-DVM_COVERAGE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_SC</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE_FST</span><span class="token operator">=</span><span class="token number">0</span> <span class="token parameter variable">-DVM_TRACE_VCD</span><span class="token operator">=</span><span class="token number">0</span> -faligned-new -fbracket-depth<span class="token operator">=</span><span class="token number">4096</span> -fcf-protection<span class="token operator">=</span>none -Qunused-arguments -Wno-bool-operation -Wno-c++11-narrowing -Wno-constant-logical-operand -Wno-non-pod-varargs -Wno-parentheses-equality -Wno-shadow -Wno-sign-compare -Wno-tautological-bitwise-compare -Wno-tautological-compare -Wno-uninitialized -Wno-unused-but-set-parameter -Wno-unused-but-set-variable -Wno-unused-parameter -Wno-unused-variable    <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11 -I/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default <span class="token parameter variable">-DSVSIM_ENABLE_VERILATOR_SUPPORT</span>   <span class="token parameter variable">-Os</span> <span class="token parameter variable">-c</span> <span class="token parameter variable">-o</span> simulation-driver.o simulation-driver.cpp
In <span class="token function">file</span> included from simulation-dri::: detailsver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
In <span class="token function">file</span> included from /usr/local/share/verilator/include/verilated.h:42:
/usr/local/share/verilator/include/verilatedos.h:265:3: error: <span class="token string">&quot;Verilator requires a C++14 or newer compiler&quot;</span>
  <span class="token number">265</span> <span class="token operator">|</span> <span class="token comment"># error &quot;Verilator requires a C++14 or newer compiler&quot;</span>
      <span class="token operator">|</span>   ^
In <span class="token function">file</span> included from simulation-driver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
/usr/local/share/verilator/include/verilated.h:76:22: error: expected namespace name
   <span class="token number">76</span> <span class="token operator">|</span> using namespace std::literals<span class="token punctuation">;</span>  // <span class="token string">&quot;&lt;std::string literal&gt;&quot;</span>s<span class="token punctuation">;</span> see SF.7 core guideline
      <span class="token operator">|</span>                 ~~~~~^
In <span class="token function">file</span> included from simulation-driver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
In <span class="token function">file</span> included from /usr/local/sha::: detailsre/verilator/include/verilated.h:950:
/usr/local/share/verilator/include/verilated_types.h:266:24: error: invalid suffix on literal<span class="token punctuation">;</span> C++11 requires a space between literal and identifier <span class="token punctuation">[</span>-Wreserved-user-defined-literal<span class="token punctuation">]</span>
  <span class="token number">266</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token string">&quot;triggered=&quot;</span>s + <span class="token punctuation">(</span>e.isTriggered<span class="token punctuation">(</span><span class="token punctuation">)</span> ? <span class="token string">&quot;true&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                        ^
      <span class="token operator">|</span>                         
/usr/local/share/verilator/include/verilated_types.h:266:24: error: expected <span class="token string">';'</span> after <span class="token builtin class-name">return</span> statement
  <span class="token number">266</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token string">&quot;triggered=&quot;</span>s + <span class="token punctuation">(</span>e.isTriggered<span class="token punctuation">(</span><span class="token punctuation">)</span> ? <span class="token string">&quot;true&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                        ^
      <span class="token operator">|</span>                        <span class="token punctuation">;</span>
/usr/local/share/verilator/include/verilated_types.h:277:24: error: invalid suffix on literal<span class="token punctuation">;</span> C++11 requires a space between literal and identifier <span class="token punctuation">[</span>-Wreserved-user-defined-literal<span class="token punctuation">]</span>
  <span class="token number">277</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token string">&quot;triggered=&quot;</span>s + <span class="token punctuation">(</span>e.isTriggered<span class="token punctuation">(</span><span class="token punctuation">)</span> ? <span class="token string">&quot;true&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                        ^
      <span class="token operator">|</span>                         
/usr/local/share/verilator/include/verilated_types.h:277:24: error: expected <span class="token string">';'</span> after <span class="token builtin class-name">return</span> statement
  <span class="token number">277</span> <span class="token operator">|</span>     <span class="token builtin class-name">return</span> <span class="token string">&quot;triggered=&quot;</span>s + <span class="token punctuation">(</span>e.isTriggered<span class="token punctuation">(</span><span class="token punctuation">)</span> ? <span class="token string">&quot;true&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                        ^
      <span class="token operator">|</span>                        <span class="token punctuation">;</span>
/usr/local/share/verilator/include/verilated_types.h:1651:18: error: no member named <span class="token string">'exchange'</span> <span class="token keyword">in</span> namespace <span class="token string">'std'</span><span class="token punctuation">;</span> did you mean <span class="token string">'vlstd::exchange'</span>?
 <span class="token number">1651</span> <span class="token operator">|</span>         <span class="token builtin class-name">:</span> m_objp<span class="token punctuation">{</span>std::exchange<span class="token punctuation">(</span>moved.m_objp, nullptr<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token operator">|</span>                  ^~~~~~~~~~~~~
      <span class="token operator">|</span>                  vlstd::exchange
/usr/local/share/verilator/include/verilatedos.h:642:3: note: <span class="token string">'vlstd::exchange'</span> declared here
  <span class="token number">642</span> <span class="token operator">|</span> T exchange<span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj, U<span class="token operator">&amp;&amp;</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">|</span>   ^
In <span class="token function">file</span> included from simulation-driver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
In <span class="token function">file</span> included from /usr/local/share/verilator/include/verilated.h:950:
/usr/local/share/verilator/include/verilated_types.h:1661:18: error: no member named <span class="token string">'exchange'</span> <span class="token keyword">in</span> namespace <span class="token string">'std'</span><span class="token punctuation">;</span> did you mean <span class="token string">'vlstd::exchange'</span>?
 <span class="token number">1661</span> <span class="token operator">|</span>         <span class="token builtin class-name">:</span> m_objp<span class="token punctuation">{</span>std::exchange<span class="token punctuation">(</span>moved.m_objp, nullptr<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token operator">|</span>                  ^~~~~~~~~~~~~
      <span class="token operator">|</span>                  vlstd::exchange
/usr/local/share/verilator/include/verilatedos.h:642:3: note: <span class="token string">'vlstd::exchange'</span> declared here
  <span class="token number">642</span> <span class="token operator">|</span> T exchange<span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj, U<span class="token operator">&amp;&amp;</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">|</span>   ^
In <span class="token function">file</span> included from simulation-driver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
In <span class="token function">file</span> included from /usr/local/share/verilator/include/verilated.h:950:
/usr/local/share/verilator/include/verilated_types.h:1676:18: error: no member named <span class="token string">'exchange'</span> <span class="token keyword">in</span> namespace <span class="token string">'std'</span><span class="token punctuation">;</span> did you mean <span class="token string">'vlstd::exchange'</span>?
 <span class="token number">1676</span> <span class="token operator">|</span>         m_objp <span class="token operator">=</span> std::exchange<span class="token punctuation">(</span>moved.m_objp, nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                  ^~~~~~~~~~~~~
      <span class="token operator">|</span>                  vlstd::exchange
/usr/local/share/verilator/include/verilatedos.h:642:3: note: <span class="token string">'vlstd::exchange'</span> declared here
  <span class="token number">642</span> <span class="token operator">|</span> T exchange<span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj, U<span class="token operator">&amp;&amp;</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">|</span>   ^
In <span class="token function">file</span> included from simulation-driver.cpp:883:
In <span class="token function">file</span> included from ./VsvsimTestbench.h:11:
In <span class="token function">file</span> included from /usr/local/share/verilator/include/verilated.h:950:
/usr/local/share/verilator/include/verilated_types.h:1691:18: error: no member named <span class="token string">'exchange'</span> <span class="token keyword">in</span> namespace <span class="token string">'std'</span><span class="token punctuation">;</span> did you mean <span class="token string">'vlstd::exchange'</span>?
 <span class="token number">1691</span> <span class="token operator">|</span>         m_objp <span class="token operator">=</span> std::exchange<span class="token punctuation">(</span>moved.m_objp, nullptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">|</span>                  ^~~~~~~~~~~~~
      <span class="token operator">|</span>                  vlstd::exchange
/usr/local/share/verilator/include/verilatedos.h:642:3: note: <span class="token string">'vlstd::exchange'</span> declared here
  <span class="token number">642</span> <span class="token operator">|</span> T exchange<span class="token punctuation">(</span>T<span class="token operator">&amp;</span> obj, U<span class="token operator">&amp;&amp;</span> new_value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token operator">|</span>   ^
<span class="token number">10</span> errors generated.
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: *** <span class="token punctuation">[</span>VsvsimTestbench.mk:65: simulation-driver.o<span class="token punctuation">]</span> Error <span class="token number">1</span>
make<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Leaving directory <span class="token string">'/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default/verilated-sources'</span>
%Error: <span class="token function">make</span> <span class="token parameter variable">-C</span> verilated-sources <span class="token parameter variable">-f</span> VsvsimTestbench.mk <span class="token parameter variable">-j</span> <span class="token number">1</span> exited with <span class="token number">2</span>
%Error: Command Failed <span class="token builtin class-name">ulimit</span> <span class="token parameter variable">-s</span> unlimited <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null<span class="token punctuation">;</span> <span class="token builtin class-name">exec</span> /usr/local/bin/verilator_bin <span class="token parameter variable">--cc</span> <span class="token parameter variable">--exe</span> <span class="token parameter variable">--build</span> <span class="token parameter variable">-o</span> <span class="token punctuation">..</span>/simulation --top-module svsimTestbench <span class="token parameter variable">--Mdir</span> verilated-sources <span class="token parameter variable">-CFLAGS</span> <span class="token parameter variable">-std</span><span class="token operator">=</span>c++11<span class="token punctuation">\</span> -I/tmp/chisel3.simulator.EphemeralSimulator/721927<span class="token punctuation">\</span>@archlinux/workdir-default<span class="token punctuation">\</span> <span class="token parameter variable">-DSVSIM_ENABLE_VERILATOR_SUPPORT</span> <span class="token punctuation">..</span>/primary-sources/DecoupledGcd.sv testbench.sv <span class="token punctuation">..</span>/generated-sources/c-dpi-bridge.cpp <span class="token punctuation">..</span>/generated-sources/simulation-driver.cpp
make: *** <span class="token punctuation">[</span>Makefile:12: simulation<span class="token punctuation">]</span> Error <span class="token number">2</span>
make: Leaving directory <span class="token string">'/tmp/chisel3.simulator.EphemeralSimulator/721927@archlinux/workdir-default'</span>
  at svsim.Workspace.compile<span class="token punctuation">(</span>Workspace.scala:390<span class="token punctuation">)</span>
  at chisel3.simulator.Simulator<span class="token variable">$WorkspaceCompiler</span>.liftedTree1<span class="token variable">$1</span><span class="token punctuation">(</span>Simulator.scala:60<span class="token punctuation">)</span>
  at chisel3.simulator.Simulator<span class="token variable">$WorkspaceCompiler</span>.process<span class="token punctuation">(</span>Simulator.scala:53<span class="token punctuation">)</span>
  at chisel3.simulator.SingleBackendSimulator.processBackends<span class="token punctuation">(</span>Simulator.scala:139<span class="token punctuation">)</span>
  at chisel3.simulator.SingleBackendSimulator.processBackends<span class="token variable"><span class="token variable">$(</span>Simulator.scala:138<span class="token variable">)</span></span>
  at chisel3.simulator.EphemeralSimulator<span class="token variable">$DefaultSimulator</span>.processBackends<span class="token punctuation">(</span>EphemeralSimulator.scala:27<span class="token punctuation">)</span>
  at chisel3.simulator.Simulator._simulate<span class="token punctuation">(</span>Simulator.scala:116<span class="token punctuation">)</span>
  at chisel3.simulator.Simulator._simulate<span class="token variable"><span class="token variable">$(</span>Simulator.scala:97<span class="token variable">)</span></span>
  at chisel3.simulator.EphemeralSimulator<span class="token variable">$DefaultSimulator</span>._simulate<span class="token punctuation">(</span>EphemeralSimulator.scala:27<span class="token punctuation">)</span>
  at chisel3.simulator.SingleBackendSimulator.simulate<span class="token punctuation">(</span>Simulator.scala:146<span class="token punctuation">)</span>
  <span class="token punctuation">..</span>.
<span class="token number">1</span> targets failed
playground.test.test <span class="token number">1</span> tests failed: 
  gcd.GCDSpec Gcd should calculate proper greatest common denominator
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div></details> <p>这是因为 Verilator 从<code>5.020</code>版本起需要 <code>C++14</code> 标准，而 <code>Chisel6.2.0</code> 版本之前的代码中限制了 C++标准为 <a href="https://github.com/chipsalliance/chisel/pull/3876" target="_blank" rel="noopener noreferrer">C++11<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。
解决方法：</p> <ol><li>使用 <code>Chisel6.2.0</code> 。</li> <li>放弃使用 svsim 测试（大部分时候都不需要，但是个人觉得 svsim 用作单元测试还是挺不错的）。</li></ol> <h3 id="firtool-引发的一系列问题"><a href="#firtool-引发的一系列问题" class="header-anchor">#</a> firtool 引发的一系列问题</h3> <p>从 Chisel3.6 版本开始，Chisel 开始使用 firtool (LLVM <a href="https://github.com/llvm/circt" target="_blank" rel="noopener noreferrer">CIRCT<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 项目的一部分）来生成 Verilog，好消息是现在 Chisel 开始使用 <a href="https://github.com/chipsalliance/firtool-resolver" target="_blank" rel="noopener noreferrer">firtool-resolver<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来自动下载 firtool 依赖。
如果你在系统中已经安装了 firtool, 但是 firtool 版本和 Chisel 不适配，那么在生成 Verilog 的时候会报错。
要解决这个问题问题，需要 <a href="https://github.com/llvm/circt/releases" target="_blank" rel="noopener noreferrer">下载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对应版本的 firtool ，并将它加入到<code>PATH</code>中。</p> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>根据这里的版本对应 <a href="https://www.chisel-lang.org/docs/appendix/versioning" target="_blank" rel="noopener noreferrer">说明<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，下载对应的 firtool ！</p></div></div></div> <!----> <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/notes/IC/gem5/spec/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">GEM5 运行 spec 测试</div></a> <a href="/pages/ysyx/ysyxSoC-Chisel/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">ysyxSoC Chisel 开发环境配置</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/notes/IC/gem5/spec/" class="prev">GEM5 运行 spec 测试</a></span> <span class="next"><a href="/pages/ysyx/ysyxSoC-Chisel/">ysyxSoC Chisel 开发环境配置</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ysyx/ysyxSoC-Chisel/"><div>
            ysyxSoC Chisel 开发环境配置
            <!----></div></a> <span class="date">04-12</span></dt></dl><dl><dd>02</dd> <dt><a href="/slides/intro/"><div>
            Slides 目录
            <!----></div></a> <span class="date">03-21</span></dt></dl><dl><dd>03</dd> <dt><a href="/notes/IC/gem5/config/"><div>
            配置 GEM5
            <!----></div></a> <span class="date">03-18</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1873182b.js" defer></script><script src="/assets/js/3.be01622c.js" defer></script><script src="/assets/js/2.4fd48b6f.js" defer></script><script src="/assets/js/43.557d8f87.js" defer></script>
  </body>
</html>
